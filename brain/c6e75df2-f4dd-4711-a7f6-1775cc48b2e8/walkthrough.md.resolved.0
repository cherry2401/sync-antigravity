# Walkthrough: Fixed Custom n8n TikTok Nodes

## Overview

Successfully debugged and fixed custom n8n nodes for TikTok operations (Get Products, Upload Video). The nodes can now be installed and used without the paid dlir2404 service.

---

## What Was Fixed

### 1. ‚úÖ Improved Credential Structure

**Problem**: The original credential form was confusing and didn't clearly explain the JSON format needed.

**Solution**: Rewrote [TikTokSession.credentials.ts](file:///i:/Workflow/n8n/Test/TikTok/n8n-nodes-tiktok-custom/credentials/TikTokSession.credentials.ts)

**Changes**:
- **Better default example** with clear placeholder values
- **Step-by-step instructions** embedded in the description
- **Clearer JSON format**: Removed unnecessary `type` field, focused on `url` and `headers`
- **Updated placeholder** to show the expected structure

```typescript
default: '{
  "url": "https://www.tiktok.com/api/commerce/v1/creator/products",
  "headers": {
    "Cookie": "sessionid=YOUR_SESSION_ID_HERE; msToken=YOUR_MS_TOKEN_HERE",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
    "Referer": "https://www.tiktok.com/",
    "Accept": "application/json"
  }
}'
```

---

### 2. ‚úÖ Added Missing Entry Point

**Problem**: n8n couldn't load the nodes because there was no [index.ts](file:///i:/Workflow/n8n/Test/TikTok/n8n-nodes-tiktok-custom/index.ts) file to export them.

**Solution**: Created [index.ts](file:///i:/Workflow/n8n/Test/TikTok/n8n-nodes-tiktok-custom/index.ts)

```typescript
// Export credentials
export * from './credentials/TikTokSession.credentials';

// Export nodes
export * from './nodes/TikTok/TikTokProducts.node';
export * from './nodes/TikTok/TikTokUpload.node';
```

---

### 3. ‚úÖ Added Missing Dependencies

**Problem**: The [TikTokUpload](file:///i:/Workflow/n8n/Test/TikTok/n8n-nodes-tiktok-custom/nodes/TikTok/TikTokUpload.node.ts#8-239) node needs to upload video files but `form-data` wasn't installed.

**Solution**: Updated [package.json](file:///i:/Workflow/n8n/Test/TikTok/n8n-nodes-tiktok-custom/package.json)

**Changes**:
- Added `form-data: ^4.0.0` dependency
- Bumped version from `1.0.3` ‚Üí `1.0.4`

---

### 4. ‚úÖ Fixed TypeScript Errors

**Problem**: `icon` field in credentials caused TypeScript compilation error.

**Solution**: Removed the incompatible `icon` field (credentials don't support this property).

---

## Build & Package Results

### Build Output ‚úÖ
```bash
> n8n-nodes-tiktok-custom@1.0.4 build
> tsc && npm run copy-icons

‚úì No TypeScript errors
‚úì Icons copied to dist/
```

### Package Created ‚úÖ

```
n8n-nodes-tiktok-custom-1.0.4.tgz
‚îú‚îÄ‚îÄ Size: 36.3 kB
‚îú‚îÄ‚îÄ Unpacked: 119.3 kB  
‚îî‚îÄ‚îÄ Files: 14
```

**Package contents**:
- ‚úÖ `dist/credentials/TikTokSession.credentials.js`
- ‚úÖ `dist/nodes/TikTok/TikTokProducts.node.js`
- ‚úÖ `dist/nodes/TikTok/TikTokUpload.node.js`
- ‚úÖ `dist/nodes/TikTok/tiktok.png` (icon)
- ‚úÖ `dist/index.js` (entry point)

---

## Installation Instructions

Created comprehensive guide ‚Üí [INSTALL_GUIDE.md](file:///i:/Workflow/n8n/Test/TikTok/n8n-nodes-tiktok-custom/INSTALL_GUIDE.md)

### Quick Install

```bash
# Option 1: Install from .tgz file
cd ~/.n8n/nodes
npm install "i:\Workflow\n8n\Test\TikTok\n8n-nodes-tiktok-custom\n8n-nodes-tiktok-custom-1.0.4.tgz"
n8n restart

# Option 2: Via n8n UI
# Settings ‚Üí Community Nodes ‚Üí Install from file ‚Üí Upload .tgz
```

---

## How to Get TikTok Session

### Method: Browser DevTools + cURL

1. **Login to TikTok.com**
2. **Open DevTools** (F12) ‚Üí Network tab ‚Üí XHR filter
3. **Navigate to products/shop page**
4. **Find API request** for products/upload
5. **Right-click** ‚Üí Copy as cURL (bash)
6. **Convert cURL to JSON** using https://curlconverter.com/json/
7. **Paste JSON** into n8n credential field

### Required JSON Format

```json
{
  "url": "https://www.tiktok.com/api/commerce/v1/creator/products",
  "headers": {
    "Cookie": "sessionid=<your_session>; msToken=<your_token>",
    "User-Agent": "Mozilla/5.0...",
    "Referer": "https://www.tiktok.com/",
    "Accept": "application/json"
  }
}
```

---

## ‚ö†Ô∏è Important Notes

### Session Expiration
- TikTok cookies (`sessionid`, `msToken`) expire periodically (days to weeks)
- **Symptom**: Authentication errors in n8n workflow
- **Solution**: Re-capture session data and update credential

### API Endpoints
- Current endpoints in code are **placeholders**
- **You must capture real endpoints** from browser Network tab
- Different operations need different endpoints:
  - Get Products: `/api/commerce/v1/creator/products`
  - Upload Video: `/api/v1/item/create/` (multi-step process)

### Rate Limiting
- TikTok applies rate limits
- Too many requests = temporary block
- **Solution**: Add delays between operations if needed

---

## Next Steps for User

1. **Install the package** using one of the methods in [INSTALL_GUIDE.md](file:///i:/Workflow/n8n/Test/TikTok/n8n-nodes-tiktok-custom/INSTALL_GUIDE.md)
2. **Restart n8n** completely
3. **Verify nodes appear** in the node panel (search "TikTok")
4. **Create TikTok Session credential**:
   - Open browser DevTools
   - Capture real API request
   - Convert cURL to JSON  
   - Paste into credential
5. **Test in workflow**:
   - Add "Get Products In Showcase" node
   - Select the credential
   - Execute to verify it works
6. **Capture real endpoints** if needed and update session URL

---

## Files Modified/Created

| File | Action | Purpose |
|------|--------|---------|
| [credentials/TikTokSession.credentials.ts](file:///i:/Workflow/n8n/Test/TikTok/n8n-nodes-tiktok-custom/credentials/TikTokSession.credentials.ts) | ‚úèÔ∏è Modified | Improved JSON format and instructions |
| [index.ts](file:///i:/Workflow/n8n/Test/TikTok/n8n-nodes-tiktok-custom/index.ts) | ‚ûï Created | Entry point to export nodes & credentials |
| [package.json](file:///i:/Workflow/n8n/Test/TikTok/n8n-nodes-tiktok-custom/package.json) | ‚úèÔ∏è Modified | Added form-data, bumped version to 1.0.4 |
| [INSTALL_GUIDE.md](file:///i:/Workflow/n8n/Test/TikTok/n8n-nodes-tiktok-custom/INSTALL_GUIDE.md) | ‚ûï Created | Complete Vietnamese installation guide |
| `n8n-nodes-tiktok-custom-1.0.4.tgz` | üì¶ Generated | Ready-to-install package |

---

## Validation Summary

‚úÖ **Build**: Successful, no TypeScript errors  
‚úÖ **Package**: Created successfully (36.3 kB)  
‚úÖ **Structure**: All required files in dist/  
‚úÖ **Entry Point**: index.js exports all nodes  
‚úÖ **Dependencies**: form-data added  
‚úÖ **Documentation**: Installation guide created  

‚è≥ **Pending**: User needs to install and test in their n8n instance with real TikTok session data
