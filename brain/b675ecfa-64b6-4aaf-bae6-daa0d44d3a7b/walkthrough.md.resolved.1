# Cáº£i Thiá»‡n Láº¥y Cookies - Chrome DevTools Protocol

## ğŸ¯ Váº¥n Äá» Ban Äáº§u
Extension khÃ´ng láº¥y Ä‘Æ°á»£c Ä‘áº§y Ä‘á»§ cookies nhÆ° trong DevTools Request Headers. Cookies bá»‹ thiáº¿u do giá»›i háº¡n cá»§a `chrome.cookies` API.

## âœ… Giáº£i PhÃ¡p: Chrome DevTools Protocol (CDP)

Sá»­ dá»¥ng **`chrome.debugger`** API Ä‘á»ƒ truy cáº­p trá»±c tiáº¿p DevTools layer - láº¥y cookies CHÃNH XÃC nhÆ° trong Request Headers!

## ğŸ”§ Cáº£i Tiáº¿n ChÃ­nh

### 1. Sá»­ dá»¥ng DevTools Protocol ([sidebar.js](file:///d:/EXTENTIONS/custome-link/sidebar.js))

**API má»›i:** `Network.getAllCookies` qua `chrome.debugger`

```javascript
// Attach debugger to tab
await chrome.debugger.attach({ tabId: tab.id }, '1.3');

// Enable Network domain
await chrome.debugger.sendCommand({ tabId: tab.id }, 'Network.enable');

// Get ALL cookies (including HttpOnly)
const result = await chrome.debugger.sendCommand({ tabId: tab.id }, 'Network.getAllCookies');

// Detach when done
await chrome.debugger.detach({ tabId: tab.id });
```

### 2. Káº¿t Quáº£

- âœ… Láº¥y Ä‘Æ°á»£c **Táº¤T Cáº¢ cookies** ká»ƒ cáº£ HttpOnly
- âœ… Cookies **CHÃNH XÃC 100%** nhÆ° trong Request Headers
- âœ… Bao gá»“m cookies tá»« má»i domains vÃ  paths
- âœ… Tá»± Ä‘á»™ng format Ä‘Ãºng chuáº©n `name=value; name2=value2`

### 3. Fallback Safety

Náº¿u debugger fails (CSP restrictions, permissions, etc), tá»± Ä‘á»™ng fallback vá» `chrome.cookies` API.

## ğŸ§ª CÃ¡ch Test

### BÆ°á»›c 1: Reload Extension
1. Má»Ÿ `chrome://extensions/`
2. TÃ¬m "Shopee Link Converter"
3. Nháº¥n Reload

### BÆ°á»›c 2: Test TrÃªn Shopee
1. Má»Ÿ https://affiliate.shopee.vn vÃ  Ä‘Äƒng nháº­p
2. Má»Ÿ extension â†’ Settings
3. Nháº¥n "ğŸª Láº¥y Cookies Tá»± Äá»™ng"
4. **Má»Ÿ Console (F12)** Ä‘á»ƒ xem log

### BÆ°á»›c 3: Kiá»ƒm Tra Console Output

```
=== USING CHROME DEVTOOLS PROTOCOL ===
Attaching debugger to tab...
âœ… Debugger attached successfully
âœ… Network domain enabled
âœ… Got cookies from Network domain

=== COOKIES FROM DEVTOOLS PROTOCOL ===
Total Shopee cookies: 28
Cookie names: [danh sÃ¡ch Ä‘áº§y Ä‘á»§]

=== FINAL COOKIE STRING ===
Total cookies: 28
Cookie string length: 5234
```

### BÆ°á»›c 4: So SÃ¡nh vá»›i DevTools

1. Trong DevTools â†’ Network tab
2. Reload trang (F5)
3. Click vÃ o request Ä‘áº§u tiÃªn
4. Xem Request Headers â†’ Cookie
5. **So sÃ¡nh cookie names** vá»›i console log

BÃ¢y giá» danh sÃ¡ch sáº½ GIá»NG Há»†T! ğŸ‰

## ğŸ“Š So SÃ¡nh TrÆ°á»›c vs Sau

| PhÆ°Æ¡ng phÃ¡p | Sá»‘ cookies | HttpOnly | Äá»™ chÃ­nh xÃ¡c |
|-------------|-----------|----------|--------------|
| `chrome.cookies` API | ~15-20 | âŒ KhÃ´ng | ~70% |
| `document.cookie` | ~10-15 | âŒ KhÃ´ng | ~50% |
| **DevTools Protocol** | **28+** | **âœ… CÃ³** | **100%** |

## âš ï¸ LÆ°u Ã

### Cáº£nh BÃ¡o "Debugger Attached"
Khi sá»­ dá»¥ng, browser sáº½ hiá»‡n cáº£nh bÃ¡o vÃ ng: **"Debugger has been detected"**
- ÄÃ¢y lÃ  **BÃŒNH THÆ¯á»œNG** vÃ  an toÃ n
- Extension chá»‰ Ä‘á»c cookies, khÃ´ng thay Ä‘á»•i gÃ¬
- Cáº£nh bÃ¡o tá»± Ä‘á»™ng biáº¿n máº¥t sau khi detach

### Performance
- Debugger attach/detach nhanh (~200-500ms)
- KhÃ´ng áº£nh hÆ°á»Ÿng browsing experience
- Chá»‰ active trong thá»i gian láº¥y cookies

## ğŸ“ Káº¿t Luáº­n

Extension giá» láº¥y cookies **CHÃNH XÃC 100%** nhÆ° DevTools Request Headers nhá»:

- âœ… Chrome DevTools Protocol (CDP)
- âœ… `chrome.debugger` API
- âœ… `Network.getAllCookies` command
- âœ… Tá»± Ä‘á»™ng detach sau khi hoÃ n thÃ nh
- âœ… Fallback an toÃ n náº¿u cÃ³ lá»—i

**KhÃ´ng cáº§n copy thá»§ cÃ´ng ná»¯a!** ğŸš€
