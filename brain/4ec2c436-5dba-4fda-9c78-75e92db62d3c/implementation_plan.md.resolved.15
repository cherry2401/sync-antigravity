# Plan - Fix File Watcher HMR Loop üöÅüîÑ

The App is currently experiencing an infinite "Start/Stop" loop for the file watcher in [ChatPanel.tsx](file:///f:/Python/OpenSSH/clawdbot-client/src/components/ChatPanel.tsx). This is caused by Vite's Hot Module Replacement (HMR) triggering every time the app writes to `src/inbound_chat.json` or `src/outbound_chat.json`.

## Proposed Changes

### 1. Create Data Directory
Create a `data/` directory at the project root to house all JSON communication files.

### 2. Update [ChatPanel.tsx](file:///f:/Python/OpenSSH/clawdbot-client/src/components/ChatPanel.tsx)
- Move `INBOUND_FILE` and `OUTBOUND_FILE` constants out of the [ChatPanel](file:///f:/Python/OpenSSH/clawdbot-client/src/components/ChatPanel.tsx#183-435) component.
- Update paths to use the new `data/` directory.
- Use `process.cwd()` or a relative path that points outside of `src`.

### 3. Update [browserRelay.ts](file:///f:/Python/OpenSSH/clawdbot-client/electron/services/browserRelay.ts)
- Update `CDP_INBOUND_FILE` and `CDP_OUTBOUND_FILE` paths to point to the `data/` directory.

### 4. Update [ChopperLogs.tsx](file:///f:/Python/OpenSSH/clawdbot-client/src/components/ChopperLogs.tsx)
- Update `LOG_FILE_PATH` to point to the `data/` directory for consistency.

### 5. Update [CHOPPER_GUIDE.md](file:///f:/Python/OpenSSH/clawdbot-client/CHOPPER_GUIDE.md)
- Inform Chopper about the new folder location for communication scripts.

### 6. Update [background.js](file:///f:/Python/OpenSSH/chrome-extension/background.js)
- Implement a proactive reconnection loop using `setInterval`.
- Automatically attempt to connect to the local relay if the WebSocket is closed.
- Ensure that [ensureRelayConnection](file:///f:/Python/OpenSSH/chrome-extension/background.js#52-104) doesn't open unnecessary help pages during failed auto-reconnect attempts.

## Verification Plan

### Automated Tests
- Restart the App and verify the Extension's badge changes from `!` (error) or empty to `ON` (green/orange) automatically.
- Check extension console for "Auto-Reconnect success" logs.

### Manual Verification
- Close the App while the extension is ON.
- Re-open the App.
- Wait ~5 seconds and verify the extension re-attaches successfully without clicking.
